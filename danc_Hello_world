
import requests
import datetime
import json
requests.packages.urllib3.disable_warnings()
print ("current date and time:")
print(datetime.datetime.now())

DNAC_scheme = "https://"
DNAC_authority="sandboxdnac.cisco.com"
DNAC_port=":443"
DNAC_path_token="/dna/system/api/v1/auth/token"
DNAC_path="/dna/intent/api/v1/network-device"

DNAC_user = "devnetuser"
DNAC_psw = "Cisco123!"

token_req_ur1 = DNAC_scheme+DNAC_authority+DNAC_path_token
auth = (DNAC_user, DNAC_psw)
req = requests.post(token_req_ur1, auth=auth, verify=False)
print("API Reurn code: " + str(req.status_code))
print('Request URI: ' + token_req_ur1)
print("Username: " + DNAC_user)
resp = req.text
token = req.json()["Token"]
print("Received Token:")
print(token)
print("Length Token:")
print(len(token))

req_ur1 = DNAC_scheme+DNAC_authority+DNAC_port+DNAC_path
print(req_ur1)
headers = {'X-auth-token': token}
resp_devices = requests.request('GET', req_ur1, headers=headers, verify=False)
print(resp_devices)
resp_devices_json = resp_devices.json()

print(json.dumps(resp_devices_json, indent=4))
print('Inventory Request - Filtering output')

for device in resp_devices_json['response']:
        if device['type'] !=None:
            print('===')
            print('Hostname: ' + device['hostname'])
            print('Type: ' + device['type'])
            print('IP: ' + device['managementIpAddress'])
            print('Mac address: ' + device['macAddress'])
            print('Serial Number: ' + device['serialNumber'])